{"version":3,"file":"fetch-response-enhancer.js","sources":["../src/index.js"],"sourcesContent":["const BODY_TYPES = ['arrayBuffer', 'blob', 'formData', 'json', 'text', 'raw']\n\nconst contentTypeMap = {\n  'application/json': 'json',\n  'text/plain': 'text'\n}\n\nfunction enhanceResponse (res, opts) {\n  const { ok, headers, status, statusText } = res\n  let { bodyType } = opts.config\n\n  if (!bodyType) {\n    const contentType = headers.get('Content-Type') || ''\n    bodyType = contentTypeMap[contentType] || 'json'\n  }\n\n  if (!BODY_TYPES.includes(bodyType)) {\n    throw new Error(`Invalid bodyType of ${bodyType} provided.`)\n  }\n\n  opts.ok = ok\n  opts.headers = headers\n  opts.status = status\n  opts.statusText = statusText\n\n  if (bodyType === 'raw') {\n    opts.data = res.body\n    return Promise.resolve(opts)\n  }\n\n  return (res[bodyType]()).then(data => {\n    opts.data = data\n    return opts\n  })\n}\n\nexport default function fetchResponseEnhancer (res, config = {}) {\n  if (!res.ok) {\n    const err = new Error(`${res.status}: ${res.statusText}`)\n    err.config = config\n    return enhanceResponse(res, err)\n      .then((e) => { throw e })\n  }\n\n  return enhanceResponse(res, { config })\n}\n"],"names":["const","BODY_TYPES","contentTypeMap","application/json","text/plain","enhanceResponse","res","opts","ok","headers","status","statusText","bodyType","config","contentType","get","includes","Error","data","body","Promise","resolve","then","err","e"],"mappings":"AAAAA,IAAMC,GAAc,cAAe,OAAQ,WAAY,OAAQ,OAAQ,OAEjEC,GACJC,mBAAoB,OACpBC,aAAc,QAGhB,SAASC,EAAiBC,EAAKC,GAC7B,IAAQC,OAAIC,YAASC,WAAQC,eACvBC,EAAaL,EAAKM,gBAExB,IAAKD,EAAU,CACbZ,IAAMc,EAAcL,EAAQM,IAAI,iBAAmB,GACnDH,EAAWV,EAAeY,IAAgB,OAG5C,IAAKb,EAAWe,SAASJ,GACvB,MAAM,IAAIK,6BAA6BL,gBAQzC,OALAL,EAAKC,GAAKA,EACVD,EAAKE,QAAUA,EACfF,EAAKG,OAASA,EACdH,EAAKI,WAAaA,EAED,QAAbC,GACFL,EAAKW,KAAOZ,EAAIa,KACTC,QAAQC,QAAQd,IAGjBD,EAAIM,KAAaU,cAAKJ,GAE5B,OADAX,EAAKW,KAAOA,EACLX,mBAIX,SAA+CD,EAAKO,GAClD,uBAAKP,EAAIE,GAAI,CACXR,IAAMuB,EAAM,IAAIN,MAASX,cAAeA,cAExC,OADAiB,EAAIV,OAASA,EACNR,EAAgBC,EAAKiB,GACzBD,cAAME,GAAQ,MAAMA,IAGzB,OAAOnB,EAAgBC,UAAOO"}